<!doctype html> <html lang=en> <head> <meta charset=utf-8> <meta content="Can I rely on the Web Platform features to build my app? An overview of the device integration HTML5 APIs" name=description> <meta content="width=device-width,initial-scale=1" name=viewport> <base href=/ > <link href=https://fonts.gstatic.com/s/sourcesanspro/v13/6xK3dSBYKcSV-LCoeQqfX1RYOo3qOK7lujVj9w.woff2 rel=preload type=font/woff2 as=font crossorigin=anonymous> <link href=https://fonts.gstatic.com/s/sourcesanspro/v13/6xKydSBYKcSV-LCoeQqfX1RYOo3ig4vwlxdu3cOWxw.woff2 rel=preload type=font/woff2 as=font crossorigin=anonymous> <link href=/Material-Design-Icons.woff rel=preload type=font/woff2 as=font crossorigin=anonymous> <style>@font-face{font-family:'Source Sans Pro';font-style:normal;font-weight:400;font-display:swap;src:local('Source Sans Pro Regular'),local('SourceSansPro-Regular'),url(https://fonts.gstatic.com/s/sourcesanspro/v13/6xK3dSBYKcSV-LCoeQqfX1RYOo3qOK7lujVj9w.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Source Sans Pro';font-style:normal;font-weight:700;font-display:swap;src:local('Source Sans Pro Bold'),local('SourceSansPro-Bold'),url(https://fonts.gstatic.com/s/sourcesanspro/v13/6xKydSBYKcSV-LCoeQqfX1RYOo3ig4vwlxdu3cOWxw.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:"Material Design Icons";src:url(/Material-Design-Icons.woff) format("woff");font-weight:400;font-style:normal}</style> <link href=icon-76x76.png rel=apple-touch-icon sizes="60x60 72x72 76x76"> <link href=icon-120x120.png rel=apple-touch-icon sizes="114x114 120x120"> <link href=icon-144x144.png rel=apple-touch-icon sizes=144x144> <link href=icon-152x152.png rel=apple-touch-icon sizes=152x152> <link href=icon-180x180.png rel=apple-touch-icon sizes="167x167 180x180"> <link href=icon-32x32.png rel=icon sizes="16x16 32x32" type=image/png> <link href=icon-96x96.png rel=icon sizes=96x96 type=image/png> <link href=icon-192x192.png rel=icon sizes=192x192 type=image/png> <link href=manifest.json rel=manifest> <link href=client/main.20781438.css rel=stylesheet><link href=client/[slug].379efbbb.css rel=stylesheet><link href=client/Article.528b6c68.css rel=stylesheet><link href=client/PromoBox.d1dab6ec.css rel=stylesheet><link href=client/prism.7976db51.css rel=stylesheet> <noscript id=sapper-head-start></noscript><title>What Web Can Do Today: How to use Chrome Dev Tools Service Worker switches</title> <meta content="What Web Can Do Today: How to use Chrome Dev Tools Service Worker switches" property=og:title> <meta content="Google Chrome, as expected from the Service Worker API and whole Progressive Web Apps ideas main proponent, offers probably the richest developer tooling to ease the debugging, testing and experimenting with the APIs. Chrome's Dev Tools has a whole Application tab dedicated to PWA-related matters." property=og:description> <meta content=https://whatwebcando.today//articles/use-chrome-dev-tools-switches/ property=og:url> <meta content=https://whatwebcando.today//articleimgs/analogue-console-control.pexels.jpg property=og:image> <meta content="What Web Can Do Today: How to use Chrome Dev Tools Service Worker switches" name=twitter:title> <meta content="Google Chrome, as expected from the Service Worker API and whole Progressive Web Apps ideas main proponent, offers probably the richest developer tooling to ease the debugging, testing and experimenting with the APIs. Chrome's Dev Tools has a whole Application tab dedicated to PWA-related matters." name=twitter:description> <meta content=https://whatwebcando.today//articleimgs/analogue-console-control.pexels.jpg name=twitter:image><noscript id=sapper-head-end></noscript> <meta content=yes name=apple-mobile-web-app-capable> <meta content=yes name=mobile-web-app-capable> <meta content="What Web Can Do Today" name=application-name> <meta content="What Web Can Do" name=apple-mobile-web-app-title> <meta content=https://whatwebcando.today/icon-144x144.png name=msapplication-TileImage> <meta content=#ffffff name=theme-color> <meta content=#ffffff name=msapplication-navbutton-color> <meta content=black-translucent name=apple-mobile-web-app-status-bar-style> <meta content=/ name=msapplication-starturl> <meta content=website property=og:type> <meta content=WhatWebCanDo property=og:site_name> <meta content=summary name=twitter:card> <meta content=@WhatWebCanDo name=twitter:site> <meta content="ArwJxpJHLSWVBvjjQdrLQmaNmEWqwy8avXhfQz6LucaHi6E8WQqBaOblE0Z5VKA6J9kgb07nziI5EF/LmdX6+woAAABSeyJvcmlnaW4iOiJodHRwczovL3doYXR3ZWJjYW5kby50b2RheTo0NDMiLCJmZWF0dXJlIjoiV2ViTkZDIiwiZXhwaXJ5IjoxNTg2MTkzMzI1fQ==" http-equiv=origin-trial> <meta content=AvXPG1STQvEBgDH2JFiDYWH1E1Eev55sYyz+szZiCeHhwQ/VAGicjx09J1WuU2Oj5q2WRr8zZsCe7jrd+a8zTA4AAABUeyJvcmlnaW4iOiJodHRwczovL3doYXR3ZWJjYW5kby50b2RheTo0NDMiLCJmZWF0dXJlIjoiV2FrZUxvY2siLCJleHBpcnkiOjE1ODYxOTMzOTh9 http-equiv=origin-trial> <meta content=AokzD/SJeJfcKJARUtujICN14urOGYKGGlHJWE2Aixopd5YQcdCwchsqcwS84XJSX6PJTkMuabIcE1ZRZxuMzgEAAABXeyJvcmlnaW4iOiJodHRwczovL3doYXR3ZWJjYW5kby50b2RheTo0NDMiLCJmZWF0dXJlIjoiU21zUmVjZWl2ZXIiLCJleHBpcnkiOjE1ODM3NzQwODl9 http-equiv=origin-trial> </head> <body> <div id=sapper> <header class="svelte-1y3p91s text-center"> <nav> <ul class=svelte-1y3p91s> <li class=svelte-1y3p91s><a href=. class=svelte-1y3p91s>Features</a></li> <li class=svelte-1y3p91s><a href=/articles/ class="svelte-1y3p91s selected">Articles</a></li> <li class=svelte-1y3p91s><a href=https://adambar.pl/#services class=svelte-1y3p91s rel=noopener target=_blank>Services</a></li> <li class=svelte-1y3p91s><a href=https://adambar.pl/#workshops class=svelte-1y3p91s rel=noopener target=_blank>Trainings</a></li> </ul> </nav> <div class="svelte-1y3p91s title-container"> <h1 class=svelte-1y3p91s>What Web Can Do Today?</h1> <p class=svelte-1y3p91s>Can I rely on the Web Platform features to build my app?</p> <p class=svelte-1y3p91s>An overview of the device integration HTML5 APIs</p> </div> </header> <div class="svelte-nzu3si container"> <main class=svelte-nzu3si> <nav aria-label=breadcrumbs class=breadcrumb> <ul> <li><a href=/ >Features</a></li> <li><a href=/articles/ >Articles</a></li> <li class=is-active><a href=/articles/use-chrome-dev-tools-switches/ aria-current=page>How to use Chrome Dev Tools Service Worker switches</a></li> </ul> </nav> <h1>How to use Chrome Dev Tools Service Worker switches</h1> <div class="svelte-nzu3si content language-javascript"> <p>Google Chrome, as expected from the Service Worker API and whole Progressive Web Apps ideas main proponent, offers probably the richest developer tooling to ease the debugging, testing and experimenting with the APIs. Chrome's Dev Tools has a whole Application tab dedicated to PWA-related matters. </p> <p>This tab offers the ability to inspect and clear the data in all the available storage types (Local Storage, Session Storage, IndexedDB, obsolete Web SQL, Cookies and Cache API) as well as to trace background services' activity (including Background Fetch, <a href=https://whatwebcando.today/background-sync.html>Background Sync</a>, <a href=https://whatwebcando.today/local-notifications.html>Notifications</a>, <a href=https://whatwebcando.today/push-notifications.html>Push API</a> and <a href=https://whatwebcando.today/payments.html>Payments</a>. There's also a separate page for Service Worker inspection, and this is where we're going to have a closer look at the three small checkboxes at the top.</p> <figure> <img alt="Chrome's Application tab switches" src=/articleimgs/chrome-switch-update-on-reload.png> <figcaption>Google Chrome's Dev Tools Application tab switches</figcaption> </figure> <h2 id=offline-switch>"Offline" switch</h2> <p>The first one is Offline switch. It's the most self-describing one. By checking it we simulate the lack of internet connectivity from our tab, causing all the network requests to fail and letting us test our offline behaviors. It is equivalent to setting the network emulation to Offline in the Network tab - both do exactly the same and both are issuing a yellow warning badge to save us from unnecessary debugging when we forgot we turned this feature on.</p> <figure> <img alt="Chrome's Network tab 'Disable cache' switch" src=/articleimgs/chrome-switch-disable-cache.png> <figcaption>Chrome's Network tab "Disable cache' switch, equivalent to Application tab "Offline" switch</figcaption> </figure> <p>All the requests will fail to reach the network, so their Promises will get rejected without creating the <code>Response</code> object. </p> <p><strong>When to switch it ON?</strong> When testing the <a href=https://whatwebcando.today/offline.html>offline state</a> caches and behaviors of our Progressive Web App.</p> <h2 id=update-on-reload-switch>"Update on reload" switch</h2> <p><img alt="How to use Chrome Dev Tools Service Worker switches" src=/articleimgs/analogue-console-control.pexels.jpg></p> <p>"Update on reload" checkbox is definitely less self-describing. It alters the rule when the browser checks for the new Service Worker version and when that new version is activated, in case it was found. Normally, when the switch is off (or when there's no Dev Tools opened), browsers have its rules how often to check for the new version – Chrome doesn't do that more often than once a day. Also, activating the new version of the Service Worker after it was deployed over the old one requires one of the two things to happen: either closing all the tabs of the application (or hard-refreshing them), so that the number of the previous Service Worker's clients fall down to 0 and it can safely be disposed, or calling <code>self.skipWaiting()</code> by the newly installed Service Worker, in case it's OK to take over the existing clients in the middle of their lifetime. Both options has its downsides and <a href=/articles/handling-service-worker-updates>implementing the full and bullet-proof update flow for the Service Worker is tricky</a>. And especially in the development, it's rather annoying that the Service Worker we expect to be running might either be unnoticed by the browser yet or it might be idly waiting for its moment to activate and we might be spending our time uselessly debugging the outdated version of our code.</p> <p>By checking "Update on reload" we effectively ask our browser to unconditionally check if there's a new Service Worker version available and if so, we ask that new Service Worker to <code>skipWaiting</code> immediately after it gets installed without the need to close the tabs or go through the standard update flow. It's like we'd implement a call to <code>skipWaiting()</code> as a part of the new Service Worker's <code>install</code> handler, asking it to forcefully take over all the clients. This is not necessarily what we want in production to happen, but it could save us some time and inconvenience at the development time.</p> <p>The update forced by "Update on reload" is an ordinary one. It causes all the installation and activation phases to run in the Service Worker as well as it is communicated to the clients with <code>updatefound</code> and <code>controllerchange</code> events. So in case we refresh all the open tabs of our application on <code>controllerchange</code> event, we need to be aware that it would happen every time we refresh any of our tabs. Also, due to what <a href=https://github.com/google/WebFundamentals/pull/5536/files>seems to be a long-standing Dev Tools bug</a>, we need to add an additional check to ensure we only refresh it once, because apparently with "Update on reload" checked, our <code>controllerchange</code> event might be triggered multiple times, causing an infinite refresh loop:</p> <pre><code>var preventDevToolsReloadLoop;
navigator.serviceWorker.addEventListener('controllerchange', (event) => {
    // Ensure refresh is only called once.
    // This works around a bug in "force update on reload".
    if (preventDevToolsReloadLoop) return;
    preventDevToolsReloadLoop = true;
    window.location.reload();
});</code></pre><p><strong>When to switch it ON?</strong> All the time in development, except when we're actually working on the Service Worker update flow for our app (because, with the switch ON, we won't be able to test it reliably).</p> <h2 id=bypass-for-network-switch>"Bypass for network" switch</h2> <p>The role of the last switch, "Bypass for network", might also not be obvious. It is there to disable Service Worker-level caching to ensure that in development we never hit the cache and always reproduce the behavior corresponding to the first visit (with no Service Worker active yet). </p> <p>Technically, this is achieved by ignoring the <code>fetch</code> event handler, so we need to be aware of all its consequences, apart from the intended one – getting no responses from Cache API. None of the code we put in <code>fetch</code> handler gets called, so nothing is written to the cache, no <code>console.log</code>s from <code>fetch</code> or no Service Worker-side routing happens. Whatever we put into the <code>fetch</code> handler, with this switch turned on, is a dead code.</p> <p>On the other hand, we need to be aware that it is distinct from the well-known "Disable cache" switch from the Network tab:</p> <figure> <img alt="Chrome's Network tab 'Disable cache' switch" src=/articleimgs/chrome-switch-disable-cache.png> <figcaption>Chrome's Network tab "Disable cache' switch, NOT equivalent to Application tab "Bypass for network" switch</figcaption> </figure> <p>That one over there turns off the browser-level HTTP cache only, which is one level below in the stack, while "Bypass for network" in turn only disables the Service Worker behavior. And as both the switches work independently, we will not actually hit the network despite "Bypass for network" turned on in case we don't have "Disable cache" also enabled and when our HTTP-level cache has a response for us to serve. From the Service Worker perspective, such a request is served "by network" and it is oblivious of how the network stack below works.</p> <p><strong>When to switch it ON?</strong> It might be useful to determine if the cause for data inconsistency is at the Service Worker caching layer. Might also be useful in case our app heavily uses <a href=https://developers.google.com/web/fundamentals/instant-and-offline/offline-cookbook#cache-falling-back-to-network>cache-first offline handling strategies</a>. For the most time in development, it should be fine not to use it, though.</p> </div> <div class="svelte-nzu3si author"><p><a href=https://adambar.pl>Adam Bar</a></p> </div> </main> <aside class=svelte-nzu3si> <h2 class=svelte-mceqtp>Advertisement</h2> <div class=ad> <script src="//cdn.carbonads.com/carbon.js?serve=CK7DT23L&placement=whatwebcandotoday" async id=_carbonads_js></script> </div> <h2 class=svelte-nzu3si>See also</h2> <div class="svelte-1itfw3h article"> <a href=/articles/progressive-web-apps-standard-or-buzzword/ class=svelte-1itfw3h rel=prefetch> <figure> <img alt="Progressive Web Apps – standard or buzzword?" src=/articleimgs/adult-books-business-coffee.pexels.jpg class=svelte-1itfw3h loading=lazy> <figcaption class=svelte-1itfw3h>PWA, Service Worker</figcaption> </figure> <div class="svelte-1itfw3h description"> <h3 class=svelte-1itfw3h>Progressive Web Apps – standard or buzzword?</h3> <p>Progressive Web Apps (PWA) is modern way to build applications, including mobile ones, using purely web technologies and relying purely on the capabilities and strengths the Web platform. Historically, it was the lack of these capabilities on the Web that caused the boom of the mobile apps, using so-called "native" (platform-specific) development approaches.</p> </div> </a> </div><div class="svelte-1itfw3h article"> <a href=/articles/handling-service-worker-updates/ class=svelte-1itfw3h rel=prefetch> <figure> <img alt="Handling Service Worker updates – how to keep the app updated and stay sane" src=/articleimgs/floor-plan-on-table.pexels.jpg class=svelte-1itfw3h loading=lazy> <figcaption class=svelte-1itfw3h>Service Worker, Offline Capabilities</figcaption> </figure> <div class="svelte-1itfw3h description"> <h3 class=svelte-1itfw3h>Handling Service Worker updates – how to keep the app updated and stay sane</h3> <p>Most of the Service Worker tutorials we can find on the Web focus on the initial development efforts needed to get the offline mode capabilities or performance gains for subsequent visits. But for production readiness, it is not enough, though. We need to have the update strategy in place not to cut off our users from actually getting the updates of our PWA.</p> </div> </a> </div><div class="svelte-1itfw3h article"> <a href=https://www.e-point.com/blog/who-can-benefit-from-a-progressive-web-app class=svelte-1itfw3h rel=noopener target=_blank> <figure> <img alt="Who can benefit from a Progressive Web App" src=/articleimgs/who-can-benefit-from-a-progressive-web-app-lead.jpg class=svelte-1itfw3h loading=lazy> <figcaption class=svelte-1itfw3h>PWA</figcaption> </figure> <div class="svelte-1itfw3h description"> <h3 class=svelte-1itfw3h>Who can benefit from a Progressive Web App</h3> <p>Progressive Web Apps are considered the next earthquake when considering mobile internet usage. But which company can benefit the most from introducing a PWA?</p> <p class="svelte-1itfw3h source">Article by e-point.com</p> </div> </a> </div> <p class="svelte-nzu3si see-all text-center"> <a href=/articles/ class=button>See all</a> </p> </aside> </div> <div class="svelte-p0dnmz loader" aria-hidden=true> <div class="svelte-p0dnmz lds-ellipsis"> <div class=svelte-p0dnmz></div><div class=svelte-p0dnmz></div><div class=svelte-p0dnmz></div><div class=svelte-p0dnmz></div> </div> </div> <div class="svelte-btjd4g container" aria-label="Website footer"> <div class="text-center contact"> <h2 class=svelte-btjd4g>Get in touch</h2> <ul class=svelte-btjd4g> <li class=svelte-btjd4g><a href=mailto:hi@adambar.pl class="svelte-btjd4g icon mail-icon">Mail</a></li> <li class=svelte-btjd4g><a href=https://twitter.com/WhatWebCanDo class="svelte-btjd4g icon twitter-icon" rel="noreferrer noopener" target=_blank>Twitter</a></li> <li class=svelte-btjd4g><a href=https://linkedin.com/in/adamrbar class="svelte-btjd4g icon linkedin-icon" rel="noreferrer noopener" target=_blank>LinkedIn</a></li> <li class=svelte-btjd4g><a href=https://github.com/NOtherDev/whatwebcando class="svelte-btjd4g icon github-icon" rel="noreferrer noopener" target=_blank>GitHub</a></li> </ul> </div> <footer class=svelte-btjd4g role=contentinfo> <p class=text-left><a href=/privacy.html class=svelte-btjd4g>Privacy Policy</a></p> <p class=text-right> Created by <a href=https://adambar.pl class=svelte-btjd4g rel=noopener target=_blank>Adam Bar</a><br> Licenced under <a href=https://creativecommons.org/licenses/by-sa/4.0/ class=svelte-btjd4g rel="noreferrer noopener" target=_blank>CC-BY-SA 4.0</a> </p> </footer> </div></div> <script src=https://browser.sentry-cdn.com/5.12.1/bundle.min.js crossorigin=anonymous integrity=sha384-y+an4eARFKvjzOivf/Z7JtMJhaN6b+lLQ5oFbBbUwZNNVir39cYtkjW1r6Xjbxg3></script> <script>window.Sentry && Sentry.init({ dsn: 'https://f769df61d95342d7af636da1f998069c@sentry.io/1876595' });</script> <script>__SAPPER__={baseUrl:"",preloaded:[void 0,null,(function(a,b,c,d){return {article:{title:"How to use Chrome Dev Tools Service Worker switches",slug:"use-chrome-dev-tools-switches",html:"\u003Cp\u003EGoogle Chrome, as expected from the Service Worker API and whole Progressive Web Apps ideas main proponent, offers probably the richest developer tooling to ease the debugging, testing and experimenting with the APIs. Chrome&#39;s Dev Tools has a whole Application tab dedicated to PWA-related matters. \u003C\u002Fp\u003E\n\u003Cp\u003EThis tab offers the ability to inspect and clear the data in all the available storage types (Local Storage, Session Storage, IndexedDB, obsolete Web SQL, Cookies and Cache API) as well as to trace background services&#39; activity (including Background Fetch, \u003Ca href=\"https:\u002F\u002Fwhatwebcando.today\u002Fbackground-sync.html\"\u003EBackground Sync\u003C\u002Fa\u003E, \u003Ca href=\"https:\u002F\u002Fwhatwebcando.today\u002Flocal-notifications.html\"\u003ENotifications\u003C\u002Fa\u003E, \u003Ca href=\"https:\u002F\u002Fwhatwebcando.today\u002Fpush-notifications.html\"\u003EPush API\u003C\u002Fa\u003E and \u003Ca href=\"https:\u002F\u002Fwhatwebcando.today\u002Fpayments.html\"\u003EPayments\u003C\u002Fa\u003E. There&#39;s also a separate page for Service Worker inspection, and this is where we&#39;re going to have a closer look at the three small checkboxes at the top.\u003C\u002Fp\u003E\n\u003Cfigure\u003E\n  \u003Cimg src=\"\u002Farticleimgs\u002Fchrome-switch-update-on-reload.png\" alt=\"Chrome's Application tab switches\" \u002F\u003E\n  \u003Cfigcaption\u003EGoogle Chrome's Dev Tools Application tab switches\u003C\u002Ffigcaption\u003E\n\u003C\u002Ffigure\u003E\n\n\u003Ch2 id=\"offline-switch\"\u003E&quot;Offline&quot; switch\u003C\u002Fh2\u003E\n\u003Cp\u003EThe first one is Offline switch. It&#39;s the most self-describing one. By checking it we simulate the lack of internet connectivity from our tab, causing all the network requests to fail and letting us test our offline behaviors. It is equivalent to setting the network emulation to Offline in the Network tab - both do exactly the same and both are issuing a yellow warning badge to save us from unnecessary debugging when we forgot we turned this feature on.\u003C\u002Fp\u003E\n\u003Cfigure\u003E\n  \u003Cimg src=\"\u002Farticleimgs\u002Fchrome-switch-disable-cache.png\" alt=\"Chrome's Network tab 'Disable cache' switch\" \u002F\u003E\n  \u003Cfigcaption\u003EChrome's Network tab \"Disable cache' switch, equivalent to Application tab \"Offline\" switch\u003C\u002Ffigcaption\u003E\n\u003C\u002Ffigure\u003E\n\n\u003Cp\u003EAll the requests will fail to reach the network, so their Promises will get rejected without creating the \u003Ccode\u003EResponse\u003C\u002Fcode\u003E object. \u003C\u002Fp\u003E\n\u003Cp\u003E\u003Cstrong\u003EWhen to switch it ON?\u003C\u002Fstrong\u003E When testing the \u003Ca href=\"https:\u002F\u002Fwhatwebcando.today\u002Foffline.html\"\u003Eoffline state\u003C\u002Fa\u003E caches and behaviors of our Progressive Web App.\u003C\u002Fp\u003E\n\u003Ch2 id=\"update-on-reload-switch\"\u003E&quot;Update on reload&quot; switch\u003C\u002Fh2\u003E\n\u003Cp\u003E\u003Cimg src=\"\u002Farticleimgs\u002Fanalogue-console-control.pexels.jpg\" alt=\"How to use Chrome Dev Tools Service Worker switches\"\u003E\u003C\u002Fp\u003E\n\u003Cp\u003E&quot;Update on reload&quot; checkbox is definitely less self-describing. It alters the rule when the browser checks for the new Service Worker version and when that new version is activated, in case it was found. Normally, when the switch is off (or when there&#39;s no Dev Tools opened), browsers have its rules how often to check for the new version – Chrome doesn&#39;t do that more often than once a day. Also, activating the new version of the Service Worker after it was deployed over the old one requires one of the two things to happen: either closing all the tabs of the application (or hard-refreshing them), so that the number of the previous Service Worker&#39;s clients fall down to 0 and it can safely be disposed, or calling \u003Ccode\u003Eself.skipWaiting()\u003C\u002Fcode\u003E by the newly installed Service Worker, in case it&#39;s OK to take over the existing clients in the middle of their lifetime. Both options has its downsides and \u003Ca href=\"\u002Farticles\u002Fhandling-service-worker-updates\"\u003Eimplementing the full and bullet-proof update flow for the Service Worker is tricky\u003C\u002Fa\u003E. And especially in the development, it&#39;s rather annoying that the Service Worker we expect to be running might either be unnoticed by the browser yet or it might be idly waiting for its moment to activate and we might be spending our time uselessly debugging the outdated version of our code.\u003C\u002Fp\u003E\n\u003Cp\u003EBy checking &quot;Update on reload&quot; we effectively ask our browser to unconditionally check if there&#39;s a new Service Worker version available and if so, we ask that new Service Worker to \u003Ccode\u003EskipWaiting\u003C\u002Fcode\u003E immediately after it gets installed without the need to close the tabs or go through the standard update flow. It&#39;s like we&#39;d implement a call to \u003Ccode\u003EskipWaiting()\u003C\u002Fcode\u003E as a part of the new Service Worker&#39;s \u003Ccode\u003Einstall\u003C\u002Fcode\u003E handler, asking it to forcefully take over all the clients. This is not necessarily what we want in production to happen, but it could save us some time and inconvenience at the development time.\u003C\u002Fp\u003E\n\u003Cp\u003EThe update forced by &quot;Update on reload&quot; is an ordinary one. It causes all the installation and activation phases to run in the Service Worker as well as it is communicated to the clients with \u003Ccode\u003Eupdatefound\u003C\u002Fcode\u003E and \u003Ccode\u003Econtrollerchange\u003C\u002Fcode\u003E events. So in case we refresh all the open tabs of our application on \u003Ccode\u003Econtrollerchange\u003C\u002Fcode\u003E event, we need to be aware that it would happen every time we refresh any of our tabs. Also, due to what \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fgoogle\u002FWebFundamentals\u002Fpull\u002F5536\u002Ffiles\"\u003Eseems to be a long-standing Dev Tools bug\u003C\u002Fa\u003E, we need to add an additional check to ensure we only refresh it once, because apparently with &quot;Update on reload&quot; checked, our \u003Ccode\u003Econtrollerchange\u003C\u002Fcode\u003E event might be triggered multiple times, causing an infinite refresh loop:\u003C\u002Fp\u003E\n\u003Cpre\u003E\u003Ccode\u003Evar preventDevToolsReloadLoop;\nnavigator.serviceWorker.addEventListener(&#39;controllerchange&#39;, (event) =&gt; {\n    \u002F\u002F Ensure refresh is only called once.\n    \u002F\u002F This works around a bug in &quot;force update on reload&quot;.\n    if (preventDevToolsReloadLoop) return;\n    preventDevToolsReloadLoop = true;\n    window.location.reload();\n});\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003E\u003Cstrong\u003EWhen to switch it ON?\u003C\u002Fstrong\u003E All the time in development, except when we&#39;re actually working on the Service Worker update flow for our app (because, with the switch ON, we won&#39;t be able to test it reliably).\u003C\u002Fp\u003E\n\u003Ch2 id=\"bypass-for-network-switch\"\u003E&quot;Bypass for network&quot; switch\u003C\u002Fh2\u003E\n\u003Cp\u003EThe role of the last switch, &quot;Bypass for network&quot;, might also not be obvious. It is there to disable Service Worker-level caching to ensure that in development we never hit the cache and always reproduce the behavior corresponding to the first visit (with no Service Worker active yet). \u003C\u002Fp\u003E\n\u003Cp\u003ETechnically, this is achieved by ignoring the \u003Ccode\u003Efetch\u003C\u002Fcode\u003E event handler, so we need to be aware of all its consequences, apart from the intended one – getting no responses from Cache API. None of the code we put in \u003Ccode\u003Efetch\u003C\u002Fcode\u003E handler gets called, so nothing is written to the cache, no \u003Ccode\u003Econsole.log\u003C\u002Fcode\u003Es from \u003Ccode\u003Efetch\u003C\u002Fcode\u003E or no Service Worker-side routing happens. Whatever we put into the \u003Ccode\u003Efetch\u003C\u002Fcode\u003E handler, with this switch turned on, is a dead code.\u003C\u002Fp\u003E\n\u003Cp\u003EOn the other hand, we need to be aware that it is distinct from the well-known &quot;Disable cache&quot; switch from the Network tab:\u003C\u002Fp\u003E\n\u003Cfigure\u003E\n  \u003Cimg src=\"\u002Farticleimgs\u002Fchrome-switch-disable-cache.png\" alt=\"Chrome's Network tab 'Disable cache' switch\" \u002F\u003E\n  \u003Cfigcaption\u003EChrome's Network tab \"Disable cache' switch, NOT equivalent to Application tab \"Bypass for network\" switch\u003C\u002Ffigcaption\u003E\n\u003C\u002Ffigure\u003E\n\n\u003Cp\u003EThat one over there turns off the browser-level HTTP cache only, which is one level below in the stack, while &quot;Bypass for network&quot; in turn only disables the Service Worker behavior. And as both the switches work independently, we will not actually hit the network despite &quot;Bypass for network&quot; turned on in case we don&#39;t have &quot;Disable cache&quot; also enabled and when our HTTP-level cache has a response for us to serve. From the Service Worker perspective, such a request is served &quot;by network&quot; and it is oblivious of how the network stack below works.\u003C\u002Fp\u003E\n\u003Cp\u003E\u003Cstrong\u003EWhen to switch it ON?\u003C\u002Fstrong\u003E It might be useful to determine if the cause for data inconsistency is at the Service Worker caching layer. Might also be useful in case our app heavily uses \u003Ca href=\"https:\u002F\u002Fdevelopers.google.com\u002Fweb\u002Ffundamentals\u002Finstant-and-offline\u002Foffline-cookbook#cache-falling-back-to-network\"\u003Ecache-first offline handling strategies\u003C\u002Fa\u003E. For the most time in development, it should be fine not to use it, though.\u003C\u002Fp\u003E\n",image:"\u002Farticleimgs\u002Fanalogue-console-control.pexels.jpg",tags:[b,c],description:"Google Chrome, as expected from the Service Worker API and whole Progressive Web Apps ideas main proponent, offers probably the richest developer tooling to ease the debugging, testing and experimenting with the APIs. Chrome's Dev Tools has a whole Application tab dedicated to PWA-related matters.",author:"\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Fadambar.pl\"\u003EAdam Bar\u003C\u002Fa\u003E\u003C\u002Fp\u003E\n",weight:a,source:d},otherArticles:[{title:"Progressive Web Apps – standard or buzzword?",slug:"progressive-web-apps-standard-or-buzzword",image:"\u002Farticleimgs\u002Fadult-books-business-coffee.pexels.jpg",tags:[b,c],description:"Progressive Web Apps (PWA) is modern way to build applications, including mobile ones, using purely web technologies and relying purely on the capabilities and strengths the Web platform. Historically, it was the lack of these capabilities on the Web that caused the boom of the mobile apps, using so-called \"native\" (platform-specific) development approaches.",weight:a,source:d},{title:"Handling Service Worker updates – how to keep the app updated and stay sane",slug:"handling-service-worker-updates",image:"\u002Farticleimgs\u002Ffloor-plan-on-table.pexels.jpg",tags:[c,"Offline Capabilities"],description:"Most of the Service Worker tutorials we can find on the Web focus on the initial development efforts needed to get the offline mode capabilities or performance gains for subsequent visits. But for production readiness, it is not enough, though. We need to have the update strategy in place not to cut off our users from actually getting the updates of our PWA.",weight:a,source:d},{title:"Who can benefit from a Progressive Web App",url:"https:\u002F\u002Fwww.e-point.com\u002Fblog\u002Fwho-can-benefit-from-a-progressive-web-app",image:"\u002Farticleimgs\u002Fwho-can-benefit-from-a-progressive-web-app-lead.jpg",tags:[b],description:"Progressive Web Apps are considered the next earthquake when considering mobile internet usage. But which company can benefit the most from introducing a PWA?",weight:a,source:"e-point.com"}]}}(2,"PWA","Service Worker","wwcd"))]};if('serviceWorker' in navigator) window.addEventListener('load',function(){navigator.serviceWorker.register('/service-worker.js');});(function(){try{eval("async function x(){}");var main="/client/client.0422bd81.js"}catch(e){main="/client/legacy/client.c74a29ff.js"};var s=document.createElement("script");try{new Function("if(0)import('')")();s.src=main;s.type="module";s.crossOrigin="use-credentials";}catch(e){s.src="/client/shimport@1.0.1.js";s.setAttribute("data-main",main);}document.head.appendChild(s);}());</script> 